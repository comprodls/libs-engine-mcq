/**
 * @license RequireJS text 2.0.7 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

// license: MIT

define("text",["module"],function(module){"use strict";var text,fs,Cc,Ci,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation="undefined"!=typeof location&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||void 0),buildMap={},masterConfig=module.config&&module.config()||{};return text={version:"2.0.7",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var modName,ext,temp,strip=!1,index=name.indexOf("."),isRelative=0===name.indexOf("./")||0===name.indexOf("../");return-1!==index&&(!isRelative||index>1)?(modName=name.substring(0,index),ext=name.substring(index+1,name.length)):modName=name,temp=ext||modName,index=temp.indexOf("!"),-1!==index&&(strip="strip"===temp.substring(index+1),temp=temp.substring(0,index),ext?ext=temp:modName=temp),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);return!match||(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],!(uProtocol&&uProtocol!==protocol||uHostName&&uHostName.toLowerCase()!==hostname.toLowerCase()||(uPort||uHostName)&&uPort!==port))},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText)return void onLoad();masterConfig.isBuild=config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+(parsed.ext?"."+parsed.ext:""),url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),extPart=parsed.ext?"."+parsed.ext:"",nonStripName=parsed.moduleName+extPart,fileName=req.toUrl(parsed.moduleName+extPart)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}},"node"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(fs=require.nodeRequire("fs"),text.get=function(url,callback,errback){try{var file=fs.readFileSync(url,"utf8");0===file.indexOf("\ufeff")&&(file=file.substring(1)),callback(file)}catch(e){errback(e)}}):"xhr"===masterConfig.env||!masterConfig.env&&text.createXhr()?text.get=function(url,callback,errback,headers){var header,xhr=text.createXhr();if(xhr.open("GET",url,!0),headers)for(header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header.toLowerCase(),headers[header]);masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;4===xhr.readyState&&(status=xhr.status,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback(err)):callback(xhr.responseText),masterConfig.onXhrComplete&&masterConfig.onXhrComplete(xhr,url))},xhr.send(null)}:"rhino"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?text.get=function(url,callback){var stringBuffer,line,file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),"utf-8")),content="";try{for(stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&65279===line.charAt(0)&&(line=line.substring(1)),null!==line&&stringBuffer.append(line);null!==(line=input.readLine());)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)}:("xpconnect"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(Cc=Components.classes,Ci=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),text.get=function(url,callback){var inStream,convertStream,readData={},fileObj=new FileUtils.File(url);try{inStream=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream),inStream.init(fileObj,1,0,!1),convertStream=Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream),convertStream.init(inStream,"utf-8",inStream.available(),Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),convertStream.readString(inStream.available(),readData),convertStream.close(),inStream.close(),callback(readData.value)}catch(e){throw new Error((fileObj&&fileObj.path||"")+": "+e)}}),text}),define("text!../html/mcq.html",[],function(){return'\x3c!-- Engine Renderer Template --\x3e\r\n\x3c!-- Top level div handler to embed test engine into rendering app --\x3e\r\n<div class="mcq-body" id="mcq-engine">\r\n  <main class="main">\r\n    <section class="instructions" rv-each-instruction="content.instructions">\r\n      <p class="instruction" rv-text="instruction"></p>\r\n    </section>\r\n    <section class="stimuli">\r\n      <figure class="stimuli" rv-each-stimuli="content.stimuli"></figure>\r\n    </section>\r\n    <section class="interactions">\r\n      <section class="interaction" rv-id="interaction.id" rv-each-interaction="content.interactions">\r\n        <p class="question-text" rv-text="interaction.questiontext"></p>\r\n        \x3c!-- prompt Will be shown only if prompt text is available for interaction /--\x3e\r\n        <p class="prompt"></p>\r\n        <ul class="options" rv-if="interaction.MCQMR">\r\n          <li class="option" rv-each-optionitem="interaction.options | propertyList">\r\n            <label class="input-label">\r\n                  <span class="rejoinder invisible pull-left" rv-id="%optionitem% | idcreator \'rejoinder\'" ></span>\r\n                  <input class="option-input" rv-id="%optionitem%   | idcreator \'option\'" type="checkbox" \r\n                          rv-name="optionitem.key" rv-id="optionitem.key" data-val="{optionitem.key}"autocomplete="off" />\r\n                  <span class=\'option-content\' rv-text="optionitem.value">{optionitem.value}</span>\r\n             </label>\r\n          </li>\r\n        </ul>\r\n        <ul class="list-unstyled nested-list" rv-if="interaction.MCQSR">\r\n          <li rv-each-element="interaction.options | propertyList">\r\n            <label class="radio radio-lg"><i></i>\r\n              <span class="answer invisible wrong pull-left"></span>\r\n              <input type="radio" name="optionsRadios" class="mcqsroption" rv-id="element.key" rv-value="element.value">\r\n              <span class="content" rv-text="element.value"></span>\r\n            </label>\r\n          </li>\r\n        </ul>\r\n      </section>\r\n    </section>\r\n\r\n    <section class="feedback">\r\n      <div class="row">\r\n        <div class="col-sm-6 col-md-6">\r\n          <div class="alert alert-success" role="alert" rv-show="showFeedback.correct" rv-text="feedback.global.correct">\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="col-sm-6 col-md-6">\r\n          <div class="alert alert-danger" role="alert" rv-show="showFeedback.incorrect" rv-text="feedback.global.incorrect">\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="col-sm-6 col-md-6">\r\n          <div class="alert alert-warning" role="alert" rv-show="showFeedback.empty" rv-text="feedback.global.empty">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </main>\r\n</div>'}),define("css",[],function(){if("undefined"==typeof window)return{load:function(n,r,load){load()}};var head=document.getElementsByTagName("head")[0],engine=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,useImportLoad=!1,useOnload=!0;engine[1]||engine[7]?useImportLoad=parseInt(engine[1])<6||parseInt(engine[7])<=9:engine[2]||engine[8]?useOnload=!1:engine[4]&&(useImportLoad=parseInt(engine[4])<18);var cssAPI={};cssAPI.pluginBuilder="./css-builder";var curStyle,curSheet,ieCurCallback,createStyle=function(){curStyle=document.createElement("style"),head.appendChild(curStyle),curSheet=curStyle.styleSheet||curStyle.sheet},ieCnt=0,ieLoads=[],createIeLoad=function(url){curSheet.addImport(url),curStyle.onload=function(){processIeLoad()},31==++ieCnt&&(createStyle(),ieCnt=0)},processIeLoad=function(){ieCurCallback();var nextLoad=ieLoads.shift();if(!nextLoad)return void(ieCurCallback=null);ieCurCallback=nextLoad[1],createIeLoad(nextLoad[0])},importLoad=function(url,callback){if(curSheet&&curSheet.addImport||createStyle(),curSheet&&curSheet.addImport)ieCurCallback?ieLoads.push([url,callback]):(createIeLoad(url),ieCurCallback=callback);else{curStyle.textContent='@import "'+url+'";';var loadInterval=setInterval(function(){try{curStyle.sheet.cssRules,clearInterval(loadInterval),callback()}catch(e){}},10)}},linkLoad=function(url,callback){var link=document.createElement("link");if(link.type="text/css",link.rel="stylesheet",useOnload)link.onload=function(){link.onload=function(){},setTimeout(callback,7)};else var loadInterval=setInterval(function(){for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].href==link.href)return clearInterval(loadInterval),callback()}},10);link.href=url,head.appendChild(link)};return cssAPI.normalize=function(name,normalize){return".css"==name.substr(name.length-4,4)&&(name=name.substr(0,name.length-4)),normalize(name)},cssAPI.load=function(cssId,req,load,config){(useImportLoad?importLoad:linkLoad)(req.toUrl(cssId+".css"),load)},cssAPI}),define("css!../css/mcq",[],function(){}),function(){function sightglass(obj,keypath,callback,options){return new Observer(obj,keypath,callback,options)}function Observer(obj,keypath,callback,options){this.options=options||{},this.options.adapters=this.options.adapters||{},this.obj=obj,this.keypath=keypath,this.callback=callback,this.objectPath=[],this.update=this.update.bind(this),this.parse(),isObject(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function isObject(obj){return"object"==typeof obj&&null!==obj}function error(message){throw new Error("[sightglass] "+message)}sightglass.adapters={},Observer.tokenize=function(keypath,interfaces,root){var index,chr,tokens=[],current={i:root,path:""};for(index=0;index<keypath.length;index++)chr=keypath.charAt(index),~interfaces.indexOf(chr)?(tokens.push(current),current={i:chr,path:""}):current.path+=chr;return tokens.push(current),tokens},Observer.prototype.parse=function(){var root,path,interfaces=this.interfaces();interfaces.length||error("Must define at least one adapter interface."),~interfaces.indexOf(this.keypath[0])?(root=this.keypath[0],path=this.keypath.substr(1)):(void 0===(root=this.options.root||sightglass.root)&&error("Must define a default root adapter."),path=this.keypath),this.tokens=Observer.tokenize(path,interfaces,root),this.key=this.tokens.pop()},Observer.prototype.realize=function(){var prev,current=this.obj,unreached=!1;return this.tokens.forEach(function(token,index){isObject(current)?(void 0!==this.objectPath[index]?current!==(prev=this.objectPath[index])&&(this.set(!1,token,prev,this.update),this.set(!0,token,current,this.update),this.objectPath[index]=current):(this.set(!0,token,current,this.update),this.objectPath[index]=current),current=this.get(token,current)):(!1===unreached&&(unreached=index),(prev=this.objectPath[index])&&this.set(!1,token,prev,this.update))},this),!1!==unreached&&this.objectPath.splice(unreached),current},Observer.prototype.update=function(){var next,oldValue;(next=this.realize())!==this.target&&(isObject(this.target)&&this.set(!1,this.key,this.target,this.callback),isObject(next)&&this.set(!0,this.key,next,this.callback),oldValue=this.value(),this.target=next,(this.value()instanceof Function||this.value()!==oldValue)&&this.callback())},Observer.prototype.value=function(){if(isObject(this.target))return this.get(this.key,this.target)},Observer.prototype.setValue=function(value){isObject(this.target)&&this.adapter(this.key).set(this.target,this.key.path,value)},Observer.prototype.get=function(key,obj){return this.adapter(key).get(obj,key.path)},Observer.prototype.set=function(active,key,obj,callback){var action=active?"observe":"unobserve";this.adapter(key)[action](obj,key.path,callback)},Observer.prototype.interfaces=function(){var interfaces=Object.keys(this.options.adapters);return Object.keys(sightglass.adapters).forEach(function(i){~interfaces.indexOf(i)||interfaces.push(i)}),interfaces},Observer.prototype.adapter=function(key){return this.options.adapters[key.i]||sightglass.adapters[key.i]},Observer.prototype.unobserve=function(){var obj;this.tokens.forEach(function(token,index){(obj=this.objectPath[index])&&this.set(!1,token,obj,this.update)},this),isObject(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=sightglass:"function"==typeof define&&define.amd?define("sightglass",[],function(){return this.sightglass=sightglass}):this.sightglass=sightglass}.call(this),function(){var Rivets,bindMethod,jQuery,unbindMethod,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Rivets={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(modelName){return"%"+modelName+"%"},handler:function(context,ev,binding){return this.call(context,ev,binding.view.models)},configure:function(options){var descriptor,key,option,value;null==options&&(options={});for(option in options)if(value=options[option],"binders"===option||"components"===option||"formatters"===option||"adapters"===option)for(key in value)descriptor=value[key],Rivets[option][key]=descriptor;else Rivets.public[option]=value},bind:function(el,models,options){var view;return null==models&&(models={}),null==options&&(options={}),view=new Rivets.View(el,models,options),view.bind(),view},init:function(component,el,data){var scope,template,view;if(null==data&&(data={}),null==el&&(el=document.createElement("div")),component=Rivets.public.components[component],(template=component.template.call(this,el))instanceof HTMLElement){for(;el.firstChild;)el.removeChild(el.firstChild);el.appendChild(template)}else el.innerHTML=template;return scope=component.initialize.call(this,el,data),view=new Rivets.View(el,scope),view.bind(),view}}},window.jQuery||window.$?(jQuery=window.jQuery||window.$,_ref="on"in jQuery.prototype?["on","off"]:["bind","unbind"],bindMethod=_ref[0],unbindMethod=_ref[1],Rivets.Util={bindEvent:function(el,event,handler){return jQuery(el)[bindMethod](event,handler)},unbindEvent:function(el,event,handler){return jQuery(el)[unbindMethod](event,handler)},getInputValue:function(el){var $el;return $el=jQuery(el),"checkbox"===$el.attr("type")?$el.is(":checked"):$el.val()}}):Rivets.Util={bindEvent:function(){return"addEventListener"in window?function(el,event,handler){return el.addEventListener(event,handler,!1)}:function(el,event,handler){return el.attachEvent("on"+event,handler)}}(),unbindEvent:function(){return"removeEventListener"in window?function(el,event,handler){return el.removeEventListener(event,handler,!1)}:function(el,event,handler){return el.detachEvent("on"+event,handler)}}(),getInputValue:function(el){var o,_i,_len,_results;if("checkbox"===el.type)return el.checked;if("select-multiple"===el.type){for(_results=[],_i=0,_len=el.length;_i<_len;_i++)o=el[_i],o.selected&&_results.push(o.value);return _results}return el.value}},Rivets.TypeParser=function(){function TypeParser(){}return TypeParser.types={primitive:0,keypath:1},TypeParser.parse=function(string){return/^'.*'$|^".*"$/.test(string)?{type:this.types.primitive,value:string.slice(1,-1)}:"true"===string?{type:this.types.primitive,value:!0}:"false"===string?{type:this.types.primitive,value:!1}:"null"===string?{type:this.types.primitive,value:null}:"undefined"===string?{type:this.types.primitive,value:void 0}:""===string?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(string))?{type:this.types.primitive,value:Number(string)}:{type:this.types.keypath,value:string}},TypeParser}(),Rivets.TextTemplateParser=function(){function TextTemplateParser(){}return TextTemplateParser.types={text:0,binding:1},TextTemplateParser.parse=function(template,delimiters){var index,lastIndex,lastToken,length,substring,tokens,value;for(tokens=[],length=template.length,index=0,lastIndex=0;lastIndex<length;){if((index=template.indexOf(delimiters[0],lastIndex))<0){tokens.push({type:this.types.text,value:template.slice(lastIndex)});break}if(index>0&&lastIndex<index&&tokens.push({type:this.types.text,value:template.slice(lastIndex,index)}),lastIndex=index+delimiters[0].length,(index=template.indexOf(delimiters[1],lastIndex))<0){substring=template.slice(lastIndex-delimiters[1].length),lastToken=tokens[tokens.length-1],(null!=lastToken?lastToken.type:void 0)===this.types.text?lastToken.value+=substring:tokens.push({type:this.types.text,value:substring});break}value=template.slice(lastIndex,index).trim(),tokens.push({type:this.types.binding,value:value}),lastIndex=index+delimiters[1].length}return tokens},TextTemplateParser}(),Rivets.View=function(){function View(els,models,options){var k,option,v,_base,_i,_j,_len,_len1,_ref1,_ref2,_ref3,_ref4,_ref5;for(this.els=els,this.models=models,null==options&&(options={}),this.update=__bind(this.update,this),this.publish=__bind(this.publish,this),this.sync=__bind(this.sync,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.select=__bind(this.select,this),this.traverse=__bind(this.traverse,this),this.build=__bind(this.build,this),this.buildBinding=__bind(this.buildBinding,this),this.bindingRegExp=__bind(this.bindingRegExp,this),this.options=__bind(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),_ref1=Rivets.extensions,_i=0,_len=_ref1.length;_i<_len;_i++){if(option=_ref1[_i],this[option]={},options[option]){_ref2=options[option];for(k in _ref2)v=_ref2[k],this[option][k]=v}_ref3=Rivets.public[option];for(k in _ref3)v=_ref3[k],null==(_base=this[option])[k]&&(_base[k]=v)}for(_ref4=Rivets.options,_j=0,_len1=_ref4.length;_j<_len1;_j++)option=_ref4[_j],this[option]=null!=(_ref5=options[option])?_ref5:Rivets.public[option];this.build()}return View.prototype.options=function(){var option,options,_i,_len,_ref1;for(options={},_ref1=Rivets.extensions.concat(Rivets.options),_i=0,_len=_ref1.length;_i<_len;_i++)option=_ref1[_i],options[option]=this[option];return options},View.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},View.prototype.buildBinding=function(binding,node,type,declaration){var context,ctx,dependencies,keypath,options,pipe,pipes;return options={},pipes=function(){var _i,_len,_ref1,_results;for(_ref1=declaration.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g),_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)pipe=_ref1[_i],_results.push(pipe.trim());return _results}(),context=function(){var _i,_len,_ref1,_results;for(_ref1=pipes.shift().split("<"),_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)ctx=_ref1[_i],_results.push(ctx.trim());return _results}(),keypath=context.shift(),options.formatters=pipes,(dependencies=context.shift())&&(options.dependencies=dependencies.split(/\s+/)),this.bindings.push(new Rivets[binding](this,node,type,keypath,options))},View.prototype.build=function(){var el,parse,_i,_len,_ref1;for(this.bindings=[],parse=function(_this){return function(node){var block,childNode,delimiters,n,parser,text,token,tokens,_i,_j,_len,_len1,_ref1;if(3===node.nodeType){if(parser=Rivets.TextTemplateParser,(delimiters=_this.templateDelimiters)&&(tokens=parser.parse(node.data,delimiters)).length&&(1!==tokens.length||tokens[0].type!==parser.types.text)){for(_i=0,_len=tokens.length;_i<_len;_i++)token=tokens[_i],text=document.createTextNode(token.value),node.parentNode.insertBefore(text,node),1===token.type&&_this.buildBinding("TextBinding",text,null,token.value);node.parentNode.removeChild(node)}}else 1===node.nodeType&&(block=_this.traverse(node));if(!block)for(_ref1=function(){var _k,_len1,_ref1,_results;for(_ref1=node.childNodes,_results=[],_k=0,_len1=_ref1.length;_k<_len1;_k++)n=_ref1[_k],_results.push(n);return _results}(),_j=0,_len1=_ref1.length;_j<_len1;_j++)childNode=_ref1[_j],parse(childNode)}}(this),_ref1=this.els,_i=0,_len=_ref1.length;_i<_len;_i++)el=_ref1[_i],parse(el);this.bindings.sort(function(a,b){var _ref2,_ref3;return((null!=(_ref2=b.binder)?_ref2.priority:void 0)||0)-((null!=(_ref3=a.binder)?_ref3.priority:void 0)||0)})},View.prototype.traverse=function(node){var attribute,attributes,binder,bindingRegExp,block,identifier,regexp,type,value,_i,_j,_len,_len1,_ref1,_ref2,_ref3;for(bindingRegExp=this.bindingRegExp(),block="SCRIPT"===node.nodeName||"STYLE"===node.nodeName,_ref1=node.attributes,_i=0,_len=_ref1.length;_i<_len;_i++)if(attribute=_ref1[_i],bindingRegExp.test(attribute.name)){if(type=attribute.name.replace(bindingRegExp,""),!(binder=this.binders[type])){_ref2=this.binders;for(identifier in _ref2)value=_ref2[identifier],"*"!==identifier&&-1!==identifier.indexOf("*")&&(regexp=new RegExp("^"+identifier.replace(/\*/g,".+")+"$"),regexp.test(type)&&(binder=value))}binder||(binder=this.binders["*"]),binder.block&&(block=!0,attributes=[attribute])}for(_ref3=attributes||node.attributes,_j=0,_len1=_ref3.length;_j<_len1;_j++)attribute=_ref3[_j],bindingRegExp.test(attribute.name)&&(type=attribute.name.replace(bindingRegExp,""),this.buildBinding("Binding",node,type,attribute.value));return block||(type=node.nodeName.toLowerCase(),this.components[type]&&!node._bound&&(this.bindings.push(new Rivets.ComponentBinding(this,node,type)),block=!0)),block},View.prototype.select=function(fn){var binding,_i,_len,_ref1,_results;for(_ref1=this.bindings,_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],fn(binding)&&_results.push(binding);return _results},View.prototype.bind=function(){var binding,_i,_len,_ref1;for(_ref1=this.bindings,_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],binding.bind()},View.prototype.unbind=function(){var binding,_i,_len,_ref1;for(_ref1=this.bindings,_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],binding.unbind()},View.prototype.sync=function(){var binding,_i,_len,_ref1;for(_ref1=this.bindings,_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],"function"==typeof binding.sync&&binding.sync()},View.prototype.publish=function(){var binding,_i,_len,_ref1;for(_ref1=this.select(function(b){var _ref1;return null!=(_ref1=b.binder)?_ref1.publishes:void 0}),_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],binding.publish()},View.prototype.update=function(models){var binding,key,model,_i,_len,_ref1;null==models&&(models={});for(key in models)model=models[key],this.models[key]=model;for(_ref1=this.bindings,_i=0,_len=_ref1.length;_i<_len;_i++)binding=_ref1[_i],"function"==typeof binding.update&&binding.update(models)},View}(),Rivets.Binding=function(){function Binding(view,el,type,keypath,options){this.view=view,this.el=el,this.type=type,this.keypath=keypath,this.options=null!=options?options:{},this.getValue=__bind(this.getValue,this),this.update=__bind(this.update,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.publish=__bind(this.publish,this),this.sync=__bind(this.sync,this),this.set=__bind(this.set,this),this.eventHandler=__bind(this.eventHandler,this),this.formattedValue=__bind(this.formattedValue,this),this.parseFormatterArguments=__bind(this.parseFormatterArguments,this),this.parseTarget=__bind(this.parseTarget,this),this.observe=__bind(this.observe,this),this.setBinder=__bind(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return Binding.prototype.setBinder=function(){var identifier,regexp,value,_ref1;if(!(this.binder=this.view.binders[this.type])){_ref1=this.view.binders;for(identifier in _ref1)value=_ref1[identifier],"*"!==identifier&&-1!==identifier.indexOf("*")&&(regexp=new RegExp("^"+identifier.replace(/\*/g,".+")+"$"),regexp.test(this.type)&&(this.binder=value,this.args=new RegExp("^"+identifier.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}if(this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function)return this.binder={routine:this.binder}},Binding.prototype.observe=function(obj,keypath,callback){return Rivets.sightglass(obj,keypath,callback,{root:this.view.rootInterface,adapters:this.view.adapters})},Binding.prototype.parseTarget=function(){var token;return token=Rivets.TypeParser.parse(this.keypath),token.type===Rivets.TypeParser.types.primitive?this.value=token.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},Binding.prototype.parseFormatterArguments=function(args,formatterIndex){var ai,arg,observer,processedArgs,_base,_i,_len;for(args=function(){var _i,_len,_results;for(_results=[],_i=0,_len=args.length;_i<_len;_i++)arg=args[_i],_results.push(Rivets.TypeParser.parse(arg));return _results}(),processedArgs=[],ai=_i=0,_len=args.length;_i<_len;ai=++_i)arg=args[ai],processedArgs.push(arg.type===Rivets.TypeParser.types.primitive?arg.value:((_base=this.formatterObservers)[formatterIndex]||(_base[formatterIndex]={}),(observer=this.formatterObservers[formatterIndex][ai])||(observer=this.observe(this.view.models,arg.value,this.sync),this.formatterObservers[formatterIndex][ai]=observer),observer.value()));return processedArgs},Binding.prototype.formattedValue=function(value){var args,fi,formatter,id,processedArgs,_i,_len,_ref1,_ref2;for(_ref1=this.formatters,fi=_i=0,_len=_ref1.length;_i<_len;fi=++_i)formatter=_ref1[fi],args=formatter.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),id=args.shift(),formatter=this.view.formatters[id],processedArgs=this.parseFormatterArguments(args,fi),(null!=formatter?formatter.read:void 0)instanceof Function?value=(_ref2=formatter.read).call.apply(_ref2,[this.model,value].concat(__slice.call(processedArgs))):formatter instanceof Function&&(value=formatter.call.apply(formatter,[this.model,value].concat(__slice.call(processedArgs))));return value},Binding.prototype.eventHandler=function(fn){var binding,handler;return handler=(binding=this).view.handler,function(ev){return handler.call(fn,this,ev,binding)}},Binding.prototype.set=function(value){var _ref1;return value=value instanceof Function&&!this.binder.function&&Rivets.public.executeFunctions?this.formattedValue(value.call(this.model)):this.formattedValue(value),null!=(_ref1=this.binder.routine)?_ref1.call(this,this.el,value):void 0},Binding.prototype.sync=function(){var dependency,observer;return this.set(function(){var _i,_j,_len,_len1,_ref1,_ref2,_ref3;if(this.observer){if(this.model!==this.observer.target){for(_ref1=this.dependencies,_i=0,_len=_ref1.length;_i<_len;_i++)observer=_ref1[_i],observer.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(_ref2=this.options.dependencies)?_ref2.length:void 0))for(_ref3=this.options.dependencies,_j=0,_len1=_ref3.length;_j<_len1;_j++)dependency=_ref3[_j],observer=this.observe(this.model,dependency,this.sync),this.dependencies.push(observer)}return this.observer.value()}return this.value}.call(this))},Binding.prototype.publish=function(){var args,fi,fiReversed,formatter,id,lastformatterIndex,processedArgs,value,_i,_len,_ref1,_ref2,_ref3;if(this.observer){for(value=this.getValue(this.el),lastformatterIndex=this.formatters.length-1,_ref1=this.formatters.slice(0).reverse(),fiReversed=_i=0,_len=_ref1.length;_i<_len;fiReversed=++_i)formatter=_ref1[fiReversed],fi=lastformatterIndex-fiReversed,args=formatter.split(/\s+/),id=args.shift(),processedArgs=this.parseFormatterArguments(args,fi),(null!=(_ref2=this.view.formatters[id])?_ref2.publish:void 0)&&(value=(_ref3=this.view.formatters[id]).publish.apply(_ref3,[value].concat(__slice.call(processedArgs))));return this.observer.setValue(value)}},Binding.prototype.bind=function(){var dependency,observer,_i,_len,_ref1,_ref2,_ref3;if(this.parseTarget(),null!=(_ref1=this.binder.bind)&&_ref1.call(this,this.el),null!=this.model&&(null!=(_ref2=this.options.dependencies)?_ref2.length:void 0))for(_ref3=this.options.dependencies,_i=0,_len=_ref3.length;_i<_len;_i++)dependency=_ref3[_i],observer=this.observe(this.model,dependency,this.sync),this.dependencies.push(observer);if(this.view.preloadData)return this.sync()},Binding.prototype.unbind=function(){var ai,args,fi,observer,_i,_len,_ref1,_ref2,_ref3,_ref4;for(null!=(_ref1=this.binder.unbind)&&_ref1.call(this,this.el),null!=(_ref2=this.observer)&&_ref2.unobserve(),_ref3=this.dependencies,_i=0,_len=_ref3.length;_i<_len;_i++)observer=_ref3[_i],observer.unobserve();this.dependencies=[],_ref4=this.formatterObservers;for(fi in _ref4){args=_ref4[fi];for(ai in args)observer=args[ai],observer.unobserve()}return this.formatterObservers={}},Binding.prototype.update=function(models){var _ref1,_ref2;return null==models&&(models={}),this.model=null!=(_ref1=this.observer)?_ref1.target:void 0,null!=(_ref2=this.binder.update)?_ref2.call(this,models):void 0},Binding.prototype.getValue=function(el){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,el):Rivets.Util.getInputValue(el)},Binding}(),Rivets.ComponentBinding=function(_super){function ComponentBinding(view,el,type){var attribute,bindingRegExp,propertyName,token,_i,_len,_ref1,_ref2;for(this.view=view,this.el=el,this.type=type,this.unbind=__bind(this.unbind,this),
this.bind=__bind(this.bind,this),this.locals=__bind(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},bindingRegExp=view.bindingRegExp(),_ref1=this.el.attributes||[],_i=0,_len=_ref1.length;_i<_len;_i++)attribute=_ref1[_i],bindingRegExp.test(attribute.name)||(propertyName=this.camelCase(attribute.name),token=Rivets.TypeParser.parse(attribute.value),__indexOf.call(null!=(_ref2=this.component.static)?_ref2:[],propertyName)>=0?this.static[propertyName]=attribute.value:token.type===Rivets.TypeParser.types.primitive?this.static[propertyName]=token.value:this.observers[propertyName]=attribute.value)}return __extends(ComponentBinding,_super),ComponentBinding.prototype.sync=function(){},ComponentBinding.prototype.update=function(){},ComponentBinding.prototype.publish=function(){},ComponentBinding.prototype.locals=function(){var key,observer,result,value,_ref1,_ref2;result={},_ref1=this.static;for(key in _ref1)value=_ref1[key],result[key]=value;_ref2=this.observers;for(key in _ref2)observer=_ref2[key],result[key]=observer.value();return result},ComponentBinding.prototype.camelCase=function(string){return string.replace(/-([a-z])/g,function(grouped){return grouped[1].toUpperCase()})},ComponentBinding.prototype.bind=function(){var k,key,keypath,observer,option,options,scope,v,_base,_i,_j,_len,_len1,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;if(!this.bound){_ref1=this.observers;for(key in _ref1)keypath=_ref1[key],this.observers[key]=this.observe(this.view.models,keypath,function(_this){return function(key){return function(){return _this.componentView.models[key]=_this.observers[key].value()}}}(this).call(this,key));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),scope=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,options={},_ref2=Rivets.extensions,_i=0,_len=_ref2.length;_i<_len;_i++){if(option=_ref2[_i],options[option]={},this.component[option]){_ref3=this.component[option];for(k in _ref3)v=_ref3[k],options[option][k]=v}_ref4=this.view[option];for(k in _ref4)v=_ref4[k],null==(_base=options[option])[k]&&(_base[k]=v)}for(_ref5=Rivets.options,_j=0,_len1=_ref5.length;_j<_len1;_j++)option=_ref5[_j],options[option]=null!=(_ref6=this.component[option])?_ref6:this.view[option];this.componentView=new Rivets.View(Array.prototype.slice.call(this.el.childNodes),scope,options),this.componentView.bind(),_ref7=this.observers;for(key in _ref7)observer=_ref7[key],this.upstreamObservers[key]=this.observe(this.componentView.models,key,function(_this){return function(key,observer){return function(){return observer.setValue(_this.componentView.models[key])}}}(this).call(this,key,observer))}},ComponentBinding.prototype.unbind=function(){var key,observer,_ref1,_ref2,_ref3;_ref1=this.upstreamObservers;for(key in _ref1)observer=_ref1[key],observer.unobserve();_ref2=this.observers;for(key in _ref2)observer=_ref2[key],observer.unobserve();return null!=(_ref3=this.componentView)?_ref3.unbind.call(this):void 0},ComponentBinding}(Rivets.Binding),Rivets.TextBinding=function(_super){function TextBinding(view,el,type,keypath,options){this.view=view,this.el=el,this.type=type,this.keypath=keypath,this.options=null!=options?options:{},this.sync=__bind(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return __extends(TextBinding,_super),TextBinding.prototype.binder={routine:function(node,value){return node.data=null!=value?value:""}},TextBinding.prototype.sync=function(){return TextBinding.__super__.sync.apply(this,arguments)},TextBinding}(Rivets.Binding),Rivets.public.binders.text=function(el,value){return null!=el.textContent?el.textContent=null!=value?value:"":el.innerText=null!=value?value:""},Rivets.public.binders.html=function(el,value){return el.innerHTML=null!=value?value:""},Rivets.public.binders.show=function(el,value){return el.style.display=value?"":"none"},Rivets.public.binders.hide=function(el,value){return el.style.display=value?"none":""},Rivets.public.binders.enabled=function(el,value){return el.disabled=!value},Rivets.public.binders.disabled=function(el,value){return el.disabled=!!value},Rivets.public.binders.checked={publishes:!0,priority:2e3,bind:function(el){return Rivets.Util.bindEvent(el,"change",this.publish)},unbind:function(el){return Rivets.Util.unbindEvent(el,"change",this.publish)},routine:function(el,value){var _ref1;return"radio"===el.type?el.checked=(null!=(_ref1=el.value)?_ref1.toString():void 0)===(null!=value?value.toString():void 0):el.checked=!!value}},Rivets.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(el){return Rivets.Util.bindEvent(el,"change",this.publish)},unbind:function(el){return Rivets.Util.unbindEvent(el,"change",this.publish)},routine:function(el,value){var _ref1;return"radio"===el.type?el.checked=(null!=(_ref1=el.value)?_ref1.toString():void 0)!==(null!=value?value.toString():void 0):el.checked=!value}},Rivets.public.binders.value={publishes:!0,priority:3e3,bind:function(el){if("INPUT"!==el.tagName||"radio"!==el.type)return this.event="SELECT"===el.tagName?"change":"input",Rivets.Util.bindEvent(el,this.event,this.publish)},unbind:function(el){if("INPUT"!==el.tagName||"radio"!==el.type)return Rivets.Util.unbindEvent(el,this.event,this.publish)},routine:function(el,value){var o,_i,_len,_ref1,_ref2,_ref3,_results;if("INPUT"===el.tagName&&"radio"===el.type)return el.setAttribute("value",value);if(null!=window.jQuery){if(el=jQuery(el),(null!=value?value.toString():void 0)!==(null!=(_ref1=el.val())?_ref1.toString():void 0))return el.val(null!=value?value:"")}else if("select-multiple"===el.type){if(null!=value){for(_results=[],_i=0,_len=el.length;_i<_len;_i++)o=el[_i],_results.push(o.selected=(_ref2=o.value,__indexOf.call(value,_ref2)>=0));return _results}}else if((null!=value?value.toString():void 0)!==(null!=(_ref3=el.value)?_ref3.toString():void 0))return el.value=null!=value?value:""}},Rivets.public.binders.if={block:!0,priority:4e3,bind:function(el){var attr,declaration;if(null==this.marker)return attr=[this.view.prefix,this.type].join("-").replace("--","-"),declaration=el.getAttribute(attr),this.marker=document.createComment(" rivets: "+this.type+" "+declaration+" "),this.bound=!1,el.removeAttribute(attr),el.parentNode.insertBefore(this.marker,el),el.parentNode.removeChild(el)},unbind:function(){if(this.nested)return this.nested.unbind(),this.bound=!1},routine:function(el,value){var key,model,models,_ref1;if(!!value==!this.bound){if(value){models={},_ref1=this.view.models;for(key in _ref1)model=_ref1[key],models[key]=model;return(this.nested||(this.nested=new Rivets.View(el,models,this.view.options()))).bind(),this.marker.parentNode.insertBefore(el,this.marker.nextSibling),this.bound=!0}return el.parentNode.removeChild(el),this.nested.unbind(),this.bound=!1}},update:function(models){var _ref1;return null!=(_ref1=this.nested)?_ref1.update(models):void 0}},Rivets.public.binders.unless={block:!0,priority:4e3,bind:function(el){return Rivets.public.binders.if.bind.call(this,el)},unbind:function(){return Rivets.public.binders.if.unbind.call(this)},routine:function(el,value){return Rivets.public.binders.if.routine.call(this,el,!value)},update:function(models){return Rivets.public.binders.if.update.call(this,models)}},Rivets.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(el){if(this.handler)return Rivets.Util.unbindEvent(el,this.args[0],this.handler)},routine:function(el,value){return this.handler&&Rivets.Util.unbindEvent(el,this.args[0],this.handler),Rivets.Util.bindEvent(el,this.args[0],this.handler=this.eventHandler(value))}},Rivets.public.binders["each-*"]={block:!0,priority:4e3,bind:function(el){var attr,view,_i,_len,_ref1;if(null==this.marker)attr=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],el.removeAttribute(attr),el.parentNode.insertBefore(this.marker,el),el.parentNode.removeChild(el);else for(_ref1=this.iterated,_i=0,_len=_ref1.length;_i<_len;_i++)view=_ref1[_i],view.bind()},unbind:function(el){var view,_i,_len,_ref1;if(null!=this.iterated)for(_ref1=this.iterated,_i=0,_len=_ref1.length;_i<_len;_i++)view=_ref1[_i],view.unbind()},routine:function(el,collection){var binding,data,index,key,model,modelName,options,previous,template,view,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3;if(modelName=this.args[0],collection=collection||[],this.iterated.length>collection.length)for(_ref1=Array(this.iterated.length-collection.length),_i=0,_len=_ref1.length;_i<_len;_i++)_ref1[_i],view=this.iterated.pop(),view.unbind(),this.marker.parentNode.removeChild(view.els[0]);for(index=_j=0,_len1=collection.length;_j<_len1;index=++_j)if(model=collection[index],data={index:index},data[Rivets.public.iterationAlias(modelName)]=index,data[modelName]=model,null==this.iterated[index]){_ref2=this.view.models;for(key in _ref2)model=_ref2[key],null==data[key]&&(data[key]=model);previous=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,options=this.view.options(),options.preloadData=!0,template=el.cloneNode(!0),view=new Rivets.View(template,data,options),view.bind(),this.iterated.push(view),this.marker.parentNode.insertBefore(template,previous.nextSibling)}else this.iterated[index].models[modelName]!==model&&this.iterated[index].update(data);if("OPTION"===el.nodeName)for(_ref3=this.view.bindings,_k=0,_len2=_ref3.length;_k<_len2;_k++)binding=_ref3[_k],binding.el===this.marker.parentNode&&"value"===binding.type&&binding.sync()},update:function(models){var data,key,model,view,_i,_len,_ref1;data={};for(key in models)model=models[key],key!==this.args[0]&&(data[key]=model);for(_ref1=this.iterated,_i=0,_len=_ref1.length;_i<_len;_i++)view=_ref1[_i],view.update(data)}},Rivets.public.binders["class-*"]=function(el,value){var elClass;if(elClass=" "+el.className+" ",!value==(-1!==elClass.indexOf(" "+this.args[0]+" ")))return el.className=value?el.className+" "+this.args[0]:elClass.replace(" "+this.args[0]+" "," ").trim()},Rivets.public.binders["*"]=function(el,value){return null!=value?el.setAttribute(this.type,value):el.removeAttribute(this.type)},Rivets.public.formatters.call=function(){var args,value;return value=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],value.call.apply(value,[this].concat(__slice.call(args)))},Rivets.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(obj){var id,_base,_name;return obj.hasOwnProperty(this.id)||(id=this.counter++,Object.defineProperty(obj,this.id,{value:id})),(_base=this.weakmap)[_name=obj[this.id]]||(_base[_name]={callbacks:{}})},cleanupWeakReference:function(ref,id){if(!(Object.keys(ref.callbacks).length||ref.pointers&&Object.keys(ref.pointers).length))return delete this.weakmap[id]},stubFunction:function(obj,fn){var map,original,weakmap;return original=obj[fn],map=this.weakReference(obj),weakmap=this.weakmap,obj[fn]=function(){var k,r,response,_i,_len,_ref1,_ref2,_ref3,_ref4;response=original.apply(obj,arguments),_ref1=map.pointers;for(r in _ref1)for(k=_ref1[r],_ref4=null!=(_ref2=null!=(_ref3=weakmap[r])?_ref3.callbacks[k]:void 0)?_ref2:[],_i=0,_len=_ref4.length;_i<_len;_i++)(0,_ref4[_i])();return response}},observeMutations:function(obj,ref,keypath){var fn,functions,map,_base,_i,_len;if(Array.isArray(obj)){if(map=this.weakReference(obj),null==map.pointers)for(map.pointers={},functions=["push","pop","shift","unshift","sort","reverse","splice"],_i=0,_len=functions.length;_i<_len;_i++)fn=functions[_i],this.stubFunction(obj,fn);if(null==(_base=map.pointers)[ref]&&(_base[ref]=[]),__indexOf.call(map.pointers[ref],keypath)<0)return map.pointers[ref].push(keypath)}},unobserveMutations:function(obj,ref,keypath){var idx,map,pointers;if(Array.isArray(obj)&&null!=obj[this.id]&&(map=this.weakmap[obj[this.id]])&&(pointers=map.pointers[ref]))return(idx=pointers.indexOf(keypath))>=0&&pointers.splice(idx,1),pointers.length||delete map.pointers[ref],this.cleanupWeakReference(map,obj[this.id])},observe:function(obj,keypath,callback){var callbacks,desc,value;return callbacks=this.weakReference(obj).callbacks,null==callbacks[keypath]&&(callbacks[keypath]=[],desc=Object.getOwnPropertyDescriptor(obj,keypath),(null!=desc?desc.get:void 0)||(null!=desc?desc.set:void 0)||(value=obj[keypath],Object.defineProperty(obj,keypath,{enumerable:!0,get:function(){return value},set:function(_this){return function(newValue){var cb,map,_i,_len,_ref1;if(newValue!==value&&(_this.unobserveMutations(value,obj[_this.id],keypath),value=newValue,map=_this.weakmap[obj[_this.id]])){if(callbacks=map.callbacks,callbacks[keypath])for(_ref1=callbacks[keypath].slice(),_i=0,_len=_ref1.length;_i<_len;_i++)cb=_ref1[_i],__indexOf.call(callbacks[keypath],cb)>=0&&cb();return _this.observeMutations(newValue,obj[_this.id],keypath)}}}(this)}))),__indexOf.call(callbacks[keypath],callback)<0&&callbacks[keypath].push(callback),this.observeMutations(obj[keypath],obj[this.id],keypath)},unobserve:function(obj,keypath,callback){var callbacks,idx,map;if((map=this.weakmap[obj[this.id]])&&(callbacks=map.callbacks[keypath]))return(idx=callbacks.indexOf(callback))>=0&&(callbacks.splice(idx,1),callbacks.length||(delete map.callbacks[keypath],this.unobserveMutations(obj[keypath],obj[this.id],keypath))),this.cleanupWeakReference(map,obj[this.id])},get:function(obj,keypath){return obj[keypath]},set:function(obj,keypath,value){return obj[keypath]=value}},Rivets.factory=function(sightglass){return Rivets.sightglass=sightglass,Rivets.public._=Rivets,Rivets.public},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=Rivets.factory(require("sightglass")):"function"==typeof define&&define.amd?define("rivets",["sightglass"],function(sightglass){return this.rivets=Rivets.factory(sightglass)}):this.rivets=Rivets.factory(sightglass)}.call(this),define("mcq",["text!../html/mcq.html","css!../css/mcq.css","rivets","sightglass"],function(mcqTemplateRef){mcq=function(){"use strict";function init(elRoot,params,adaptor,htmlLayout,jsonContentObj,callback){activityAdaptor=adaptor;var jsonContent=jQuery.extend(!0,{},jsonContentObj);if(void 0===jsonContent.content)return void(callback&&callback());__buildModelandViewContent(jsonContent,params),$(elRoot).html(__constants.TEMPLATES[htmlLayout]),__initRivets(),$("input[id^=option]").change(__handleCheckboxClick),$("input[class^=mcqsroption]").change(__handleRadioButtonClick),$(document).bind("userAnswered",function(){__saveResults(!1)}),callback&&callback()}function getConfig(){}function getStatus(){}function handleSubmit(){__saveResults(!0),$("input[id^=option]").attr("disabled",!0),$("input[class^=mcqsroption]").attr("disabled",!0)}function showGrades(uniqueid){$("input[id^=option]").attr("disabled",!0),__markAnswers()}function updateLastSavedResults(lastResults){__content.user_answers={};for(var interaction in lastResults.response){__content.user_answers[interaction]=lastResults.response[interaction];for(var j=0;j<__content.user_answers[interaction].length;j++)$("#"+interaction+" input[name='"+__content.user_answers[interaction][j]+"']").checked=!0}}function showfeedback(){var type=__content.interactions[0].type;if("MCQMR"===type){for(var prop in __feedback)__feedbackState[prop]=!1;__content.user_answers.length<=0?__feedbackState.empty=!0:!function(answerjson,useranswerjson){var isCorrect=!1;if(null==answerjson||null==useranswerjson)return isCorrect=!1;if(Object.keys(answerjson).length!=Object.keys(useranswerjson).length)return isCorrect=!1;var countCorrectInteractionAttempt=0;for(var key in __content.user_answers){__content.user_answers.hasOwnProperty(key)&&__content.user_answers[key].length===__correct_answers[key].correct.length&&__content.user_answers[key].sort().join("")===__correct_answers[key].correct.sort().join("")&&countCorrectInteractionAttempt++}return countCorrectInteractionAttempt===Object.keys(__correct_answers).length?isCorrect=!0:countCorrectInteractionAttempt!==Object.keys(__correct_answers).length?isCorrect=!1:isCorrect}(__correct_answers,__content.user_answers)?__feedbackState.incorrect=!0:__feedbackState.correct=!0}"MCQSR"===type&&Object.keys(__correct_answers).forEach(function(elem,idx){var correctAnswer=__correct_answers[elem].correct,userAnswer=__content.user_answers[elem];userAnswer===correctAnswer?(__feedbackState.correct=!0,__feedbackState.incorrect=!1,__feedbackState.empty=!1):(__feedbackState.correct=!1,__feedbackState.incorrect=!0,__feedbackState.empty=!1),""==userAnswer&&(__feedbackState.correct=!1,__feedbackState.incorrect=!1,__feedbackState.empty=!0)})}function __initRivets(){rivets.formatters.propertyList=function(obj){return function(){var properties=[];for(var key in obj)properties.push({key:key,value:obj[key]});return properties}()},rivets.formatters.idcreator=function(index,idvalue){return idvalue+index};var data={content:__content,feedback:__feedback,showFeedback:__feedbackState};rivets.bind($("#mcq-engine"),data)}function __handleCheckboxClick(event){var currentTarget=event.currentTarget,currentInteractionId=currentTarget.parentElement.parentElement.parentElement.parentElement.getAttribute("id"),currentChoice=currentTarget.getAttribute("name");currentTarget.checked?(__content.user_answers[currentInteractionId]||(__content.user_answers[currentInteractionId]=[]),__content.user_answers[currentInteractionId].push(currentChoice)):function(arr,value){var found=arr.indexOf(value);-1!==found&&arr.splice(found,1)}(__content.user_answers[currentInteractionId],currentChoice),__savePartial(currentInteractionId)}function __handleRadioButtonClick(event){var currentTarget=event.currentTarget,currentInteractionId=currentTarget.parentElement.parentElement.parentElement.parentElement.getAttribute("id");$("label.radio").parent().removeClass("highlight"),$(currentTarget).parent().parent("li").addClass("highlight");currentTarget.value.replace(/^\s+|\s+$/g,"");__content.user_answers[currentInteractionId]=$(event.currentTarget).attr("id"),__state.radioButtonClicked=!0,__content.feedbackJSON=__feedback,__savePartial(currentInteractionId)}function __saveResults(bSubmit){var uniqueId=activityAdaptor.getId();__getAnswersJSON().forEach(function(answerJSON,idx){!0===bSubmit&&(answerJSON.statusProgress="attempted",activityAdaptor.submitResults(answerJSON,uniqueId,function(data,status){status===__constants.STATUS_NOERROR?(__state.activitySubmitted=!0,activityAdaptor.closeActivity(),__state.currentTries=0):__state.currentTries<__config.MAX_RETRIES&&(__state.currentTries++,__saveResults(bSubmit))}))})}function __savePartial(interactionid){var uniqueId=activityAdaptor.getId();__getAnswersJSON(!1,interactionid).forEach(function(answerJSON,idx){activityAdaptor.savePartialResults(answerJSON,uniqueId,function(data,status){status===__constants.STATUS_NOERROR&&(__state.activityPariallySubmitted=!0)})})}function __markAnswers(){__markCheckBox()}function __markCheckBox(){var interactions=__content.interactions,type=interactions[0].type;if($("input[id^=option]").prev("span").addClass("wrong"),"MCQMR"===type)for(var interaction in __correct_answers){if(__correct_answers.hasOwnProperty(interaction))for(var j=0;j<__correct_answers[interaction].correct.length;j++)$("#"+interaction+" input[name='"+__correct_answers[interaction].correct[j]+"']").prev("span").removeClass("wrong"),$("#"+interaction+" input[name='"+__correct_answers[interaction].correct[j]+"']").prev("span").removeClass("state-error"),$("#"+interaction+" input[name='"+__correct_answers[interaction].correct[j]+"']").prev("span").addClass("correct"),$("#"+interaction+" input[name='"+__correct_answers[interaction].correct[j]+"']").prev("span").addClass("state-success");$("[id^=rejoinder]").removeClass("invisible")}if("MCQSR"===type){var interactionid=Object.keys(__correct_answers);if(interactionid){var correctAnswer=__correct_answers[interactionid].correct,userAnswer=__content.user_answers[interactionid];userAnswer.trim()===correctAnswer.trim()?($("#"+userAnswer).siblings(".answer").removeClass("wrong"),$("#"+userAnswer).siblings(".answer").addClass("correct"),$("#"+userAnswer).parent().addClass("state-success")):($("#"+userAnswer).siblings(".answer").removeClass("correct"),$("#"+userAnswer).siblings(".answer").addClass("wrong"),$("#"+userAnswer).parent().addClass("state-error")),$("#"+userAnswer).siblings(".answer").removeClass("invisible")}}}function __getAnswersJSON(skipQuestion,interactionid){var response=[];if(void 0==typeof interactionid){var filteredInteraction=__content.interactions.filter(function(interaction){return interaction.id===interactionid});if(filteredInteraction){var interactiontype=filteredInteraction[0].type;if("MCQMR"==interactiontype){var mcqmrans=__getAnswersJSONMCQMR();response.push(mcqmrans)}if("MCQSR"==interactiontype){var mcqsrans=__getAnswersJSONMCQSR(!1);response.push(mcqsrans)}}}else{var mcqmrans=__getAnswersJSONMCQMR();response.push(mcqmrans);var mcqsrans=__getAnswersJSONMCQSR();response.push(mcqsrans)}return response}function __getAnswersJSONMCQMR(){var resultArray=[],statusEvaluation="empty",feedback="",maxscore=__scoring.max,perInteractionScore=__interactionIds.length/maxscore,isUserAnswerCorrect=(Object.keys(__correct_answers).length,!1),filtered=__content.interactions.filter(function(interaction){return"MCQMR"===interaction.type}),countCorrectInteractionAttempt=0;return filtered.forEach(function(eachElem,idx){var score=0,id=eachElem.id;__content.user_answers.hasOwnProperty(id)&&__content.user_answers[id].length===__correct_answers[id].correct.length&&(__content.user_answers[id].sort().join("")===__correct_answers[id].correct.sort().join("")&&(score=perInteractionScore),countCorrectInteractionAttempt++,isUserAnswerCorrect=!0),resultArray.push({itemUID:id,answer:__content.user_answers[id],score:score})}),isUserAnswerCorrect?(statusEvaluation="correct",feedback=__buildFeedbackResponse("global.correct","correct",__feedback.correct)):0===countCorrectInteractionAttempt?(statusEvaluation="incorrect",feedback=__buildFeedbackResponse("global.incorrect",statusEvaluation,__feedback.incorrect)):(statusEvaluation="partially_correct",feedback=__buildFeedbackResponse("global.incorrect","incorrect",__feedback.incorrect)),{response:{interactions:resultArray,statusEvaluation:statusEvaluation,feedback:feedback}}}function __getAnswersJSONMCQSR(skipQuestion){var score=0,answer="",interactions={},interactionArray=new Array(1),interactionId=null,filtered=__content.interactions.filter(function(interaction){return"MCQSR"===interaction.type});return skipQuestion?answer="Not Answered":filtered.forEach(function(el,idx){interactionId=el.id,answer=__content.user_answers[el.id],__correct_answers[el.id]===__content.user_answers[el.id]&&score++}),interactions={id:interactionId,answer:answer,score:score,maxscore:__scoring.max},interactionArray[0]=interactions,{response:{interactions:interactionArray}}}function __buildFeedbackResponse(id,status,content){var feedback={};return feedback.id=id,feedback.status=status,feedback.content=content,feedback}function __buildModelandViewContent(jsonContent,params){__content.instructions=jsonContent.content.instructions.map(function(element){return element[element.tag]}),__content.interactions=jsonContent.content.canvas.data.questiondata.map(function(element){var txt=element.text,obj={},parsedQuestionArray=$("<div>"+element.text+"</div>"),currinteractionid=$(parsedQuestionArray).find("a[href='"+INTERACTION_REFERENCE_STR+"']").text().trim();$("<div>").append(txt).find("a:first").attr("href");$(parsedQuestionArray).find("a[href='"+INTERACTION_REFERENCE_STR+"']").remove(),obj.id=currinteractionid,obj.questiontext=$(parsedQuestionArray).html(),obj.prompt="";var tempobj=jsonContent.content.interactions[currinteractionid],interactiontype=tempobj.type;return obj.type=interactiontype,"MCQMR"===interactiontype&&(obj.MCQMR=!0),"MCQSR"===interactiontype&&(obj.MCQSR=!0),obj.options={},tempobj[interactiontype].forEach(function(element){obj.options[Object.keys(element)[0]]=element[Object.keys(element)[0]]}),__interactionIds.push(currinteractionid),obj}),__content.stimuli=jsonContent.content.stimulus.map(function(element){var tagtype=element.tag;return"image"===tagtype?params.questionMediaBasePath+element[tagtype]:element[tagtype]}),__correct_answers=jsonContent.responses,__scoring=jsonContent.meta.score,__feedback=jsonContent.feedback}var activityAdaptor,__config={MAX_RETRIES:10},__state={currentTries:0,activityPariallySubmitted:!1,activitySubmitted:!1},__content={user_answers:{},instructions:[],interactions:[],stimuli:[],type:""},__interactionIds=[],__correct_answers={},__scoring={},__feedback={},__feedbackState={correct:!1,incorrect:!1,empty:!1},INTERACTION_REFERENCE_STR="http://www.comprodls.com/m1.0/interaction/mcq",__constants={STATUS_NOERROR:"NO_ERROR",TEMPLATES:{MCQ:mcqTemplateRef}};return{init:init,getStatus:getStatus,getConfig:getConfig,handleSubmit:handleSubmit,showGrades:showGrades,updateLastSavedResults:updateLastSavedResults,showFeedback:showfeedback}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}('/*******************************************************\r\n * \r\n * ----------------------\r\n * Engine Renderer Styles\r\n * ----------------------\r\n *\r\n * These styles do not include any product-specific branding\r\n * and/or layout / design. They represent minimal structural\r\n * CSS which is necessary for a default rendering of an\r\n * MCQSC activity\r\n *\r\n * The styles are linked/depending on the presence of\r\n * certain elements (classes / ids / tags) in the DOM (as would\r\n * be injected via a valid MCQSC layout HTML and/or dynamically\r\n * created by the MCQSC engine JS)\r\n *\r\n *\r\n *******************************************************/\r\n\r\nmain {\r\n    margin: 20px 20px 20px 20px;\r\n    font-size: 1em;\r\n}\r\n\r\n.instructions {\r\n    font-size: 1.25em;\r\n}\r\n\r\n.interactions {\r\n    font-size: 1.15em;\r\n}\r\n\r\nul {\r\n    list-style: none;\r\n    margin-left: 30px;\r\n}\r\n\r\n.correct:before,\r\n.wrong:before {\r\n    font-family: fontawesome;\r\n    display: inline-block;\r\n    margin: 0 0.5em auto -2.2em;\r\n}\r\n\r\n.correct:before {\r\n    content: "\\f00c";\r\n    color: #080;\r\n}\r\n\r\n.wrong:before {\r\n    content: "\\f00d";\r\n    color: #F00;\r\n}\r\n\r\n.option-content {\r\n    margin: 0 0 0 5px;\r\n}');